{% extends 'iraq.html' %}
{% load i18n %}

{% block javascripts %}
<script src="http://www.openlayers.org/dev/OpenLayers.js"></script>
<script src="/static/charts/javascripts/raphael-min.js"></script>
<script src="/static/charts/javascripts/graphs.js"></script>
<script type="text/javascript">
        var map;
        OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3;

        OpenLayers.ImgPath = "http://js.mapbox.com/theme/dark/";
 
        $(document).ready(function(){
            var options = {
                projection: new OpenLayers.Projection("EPSG:900913"),
                displayProjection: new OpenLayers.Projection("EPSG:4326"),
                units: "m",
                numZoomLevels: 12,
                maxResolution: 156543.0339,
maxExtent: new OpenLayers.Bounds(-20037500, -20037500, 20037500, 20037500),
                restrictedExtent: new OpenLayers.Bounds(4139217,3209132,5603139,4652263)
            };
            map = new OpenLayers.Map('map', options);
 
            // create WMS layer
            var iraq = new OpenLayers.Layer.TMS(
                "Iraq Terrain",
                [
                "http://a.tile.mapbox.com/",
                "http://b.tile.mapbox.com/",
                "http://c.tile.mapbox.com/",
                "http://d.tile.mapbox.com/"],
                {
                'layername': 'iraq',
                'type':'jpg'
                }
            );
 
            map.addLayers([iraq]); 
            map.addControl(new OpenLayers.Control.LayerSwitcher());
            map.addControl(new OpenLayers.Control.Permalink());

            if (!map.getCenter()) {
//              map.zoomToExtent(new OpenLayers.Bounds.fromString("4139217,3209132,5603139,4652263"));
map.zoomTo(6);
            }

var cities = new OpenLayers.Layer.Vector("Cities KML", {
    projection: map.displayProjection,
    strategies: [new OpenLayers.Strategy.Fixed()],
    styleMap: new OpenLayers.StyleMap(
      OpenLayers.Util.applyDefaults(
          {
            fillColor: "#93ce54", 
            fillOpacity: 1, 
            strokeColor: "#4c8014",
            pointRadius: 4
          },
          OpenLayers.Feature.Vector.style["default"]
        )
    ),
    protocol: new OpenLayers.Protocol.HTTP({
        url: "/get_kml/",
        format: new OpenLayers.Format.KML({
            extractStyles: true,
            extractAttributes: true
        })
    })
});
cities.setOpacity(0.5)
map.addLayer(cities);
        });
</script>
{% endblock %}

{% block title_suffix %}Map{% endblock %}

{% block question %}
<div class="question">
    <h2>{{ question.text }}</h2>
    <ol>

        {% for choice in choices %}
        <li>
            {{ choice.text }}
        </li>
        {% endfor %}
    </ol>
</div>
<p class="total_responses">
    215 responses <br/>
    from Bhagdad
</p>
{% endblock %}
        
{% block map_container %}
<div id="map" style="widh:500px; height:400px;"></div>
{% endblock %}
        
{% block chart %}
<div class="chart_bar">
    <h3>
        <span class="response_criteria">Top Response for {{ region }}</span>
        <span class="top_concern">{{ top_response }} {{ percentage }}%</span>
    </h3>

    <div id="chart">
        <script type="text/javascript">
            var data = {{ chart_data }}
            var country_data = {{ national_data }}
        </script>
    </div>
    <p class="chart_note">National results</p>
</div>
{% endblock %}
